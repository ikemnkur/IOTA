<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.css" rel="stylesheet" media="all">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
<title>Document</title>

<div>
  <p hidden id="rmID">{{roomObj[0]["roomID"]}}</p>
  <div id="container">
    <!-- <button id="settingsBtn"><i class="fas fa-cog"></i> Settings</button> -->
    <div id="settings" style="display: block ">
      <div style="border: 3px solid #667aff; max-width: -webkit-fill-available;">
        <div class="select" style="padding: 2px;">
          <label for="audioSource">Audio input: </label> <select id="audioSource" style="width: 200px;"></select>
        </div>

        <div class="select" style="padding: 2px;">
          <label for="audioOutput">Audio output: </label> <select id="audioOutput" style="width: 200px;"></select>
        </div>

        <div class="select" style="padding: 2px;">
          <label for="videoSource">Video source: </label> <select id="videoSource" style="width: 200px;"></select>
        </div>

        <div>
          <div id="videoDiv" style="padding: 2px;">
            <h3>Video source Preview: <p id="muteMsg" style="padding: 2px 2px 2px 2px; margin: 2px 2px 2px 2px;"></p>
            </h3>
            <video id="video" muted="true" onclick="togglemute()" style="border: 3px solid #667aff;" playsinline
              autoplay></video>

            <script>
              let vid = document.getElementById("video");
              var mutemsg;
              function togglemute() {
                vid.muted = !vid.muted;
                console.log("video clicked, muted = ", vid.muted);
                mutemsg = vid.muted;
                var mm = document.getElementById("muteMsg")
                if (!mutemsg)
                  mm.innerText = "(muted)";
                else
                  mm.innerText = "(unmuted)"
              }
            </script>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="video-grid">
    <table id="videoTable" style="min-height: 96px;"></table>
  </div>
</div>
<div id="mediaWindow"
  style="border: 5px solid #667aff; padding: 5px;  background-color: #e6e9ff; border-radius:5px; margin-right: 0%; margin-left: 0%;">
  <div style="margin: 5px;">
    <div id="searchForm">
      <table style="margin: 0px auto;">
        <tbody>
          <tr>
            <td>
              <button id="searchModeBtn"
                style="padding: 2px 5px 2px 5px; background-color:mediumorchid; float: left; border-radius: 3px;">
                <div style="display: flex;">
                  <i id="findIcon" class="fas fa-magnifying-glass"></i>
                  <text id="searchModeText" style="padding: 0px 5px 0px 5px;">Find</text>
                </div>
              </button>
            </td>
            <td>
              <span>Search: </span>
              <input id="mediaSearch" type="text" placeholder="Search Image"
                style="border: 3px solid #667aff; max-width: -webkit-fill-available;">
              <!-- <span style="float: left; margin-right: 2px; margin: 5px 2px 0px 0px;">Type: </span> -->
            </td>
            <td>
              <button id="mediaTypeBtn"
                style="padding: 2px 5px 2px 5px; background-color:greenyellow; float: right; border-radius: 3px;">
                <div style="display: flex;">
                  <i id="mediaIcon" class="fas fa-image"></i>
                  <text id="mediaTypeText" style="padding: 0px 5px 0px 5px;"> Image</text>
                </div>

              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <table style="all:revert; margin: auto;">
    <tbody>
      <tr>
        <td>
          <div id="imgPrevDiv" style="
            border: 3px solid #667aff; 
            background-color: white;
            /* margin-right: 5%;
            margin-left: 5%; */
            overflow-y: scroll;
            max-width: 300px;
            max-height: 128px;
            min-height: 48px;
            padding: 5px;
            margin-top: 2px;">
          </div>
          <textarea id="errorMsg" style=" width: 300px; height: 64px;">
            Type in the "Search" bar to get started
          </textarea>
        </td>
        <td>
          <!-- <tr> -->
          <!-- <td> -->
          <h3>Tools</h3>
          <!-- </td> -->
          <!-- <td> -->

          <!-- </td> -->
          <!-- </tr> -->


          <div id="volumeTool" hidden>
            <text>Volume: <strong id="volume">50</strong>%</text>
            <input id="volumeAmount" type="range" min="1" max="100" value="50">
          </div>
          <div id="durationTool" hidden>
            <text>Time: <strong id="duration">50</strong>%</text>
            <input id="durationAmount" type="range" min="10" max="100" value="50">
          </div>
          <div id="testSoundBtn" hidden>
            <!-- <text>Output Audio: </text>
            <button>Test Audio</button> -->
            <audio id="soundPlayer" controls src="/media/cc0-audio/t-rex-roar.mp3">
              <a id="soundPlayerLink" href="/media/cc0-audio/t-rex-roar.mp3">
                Download audio
              </a>
            </audio>
          </div>
          <div id="scaleTool">
            <text>Scale: <strong id="scale">100</strong>%</text>
            <input id="scaleAmount" type="range" min="50" max="200" value="100">
          </div>
          <div id="rotateTool">
            <text>Rotate: <strong id="rotation">0</strong>Â°</text>
            <input id="rotationAmount" type="range" min="0" max="360" value="0">
            <!-- <button id="rotate+" style="padding: 5px 5px;">+</button>
            <button id="rotate-" style="padding: 5px 5px;">-</button> -->
          </div>

          <div id="imgPrevEditDiv">
            <table>
              <tr>
                <td style="padding: 20px;">
                  <div id="imgEditDiv" style="
                  border: 3px solid #667aff; 
                  background-color: white;
                  margin-right: 25%;
                  margin-left: 25%;
                  /* margin: 0 40%; */
                  max-height: 80px;max-width: 128px;
                  min-height: 64px;min-width: 96px;
                  padding: 5px;">
                  </div>
                </td>
                <td>
                  <button id="sendImageBtn" style="padding: 5px;"> Send Image</button>
                  <div id="coinCostTool" style="padding: 5px; margin: 10px 10px;">
                    <i id="coinIcon" class="fas fa-coins"
                      style=" font-size: 20px; margin: 0px 0px 0px 5px; color: gold;"></i>
                    <text style="color: black;font-size: 20px; ">Coins: <strong style="color: black;font-size: 20px; " id="coinCost">3</strong></text>
                  </div>
                </td>
              </tr>

            </table>
          </div>
        </td>
      </tr>
    </tbody>

  </table>

</div>
<div hidden>
  <div id="soundElem" hidden style="display: flex; background: lightgrey; padding: 5px 7px 5px 7px; margin: 2px; border: #667aff;">
    <button id="playSnd" style="margin-left: 2px; margin-right: 2px; padding: 2px;"><i class="fas fa-volume-down"></i>
      <text id="playSndText" style="padding: 2px;">Play</text>
    </button>
    <button id="addToLib" hidden style="padding: 2px;"><i class="fas fa-book-medical"></i> Add </button>
    <button id="removeFromLib" hidden style="padding: 2px;"><i class="fas fa-remove"></i> Remove</button>
    <marquee id="sndName" width="150px" direction="right" scrollamount="5" height="16px"
      style="padding: 3px; margin-left: 3px; margin-right: 3px;"> SoundName.ext</marquee>
    <button id="editSnd" style=" float: right;"> Edit </button>
    <button id="sendSnd" style=" float: right;"> Send </button>
  </div>
</div>

<script>
  let mediaTypeButton = document.getElementById("mediaTypeBtn");
  let coinCost = document.getElementById("coinCost");
  let volume = document.getElementById("volume");
  let volumeAmount = document.getElementById("volumeAmount");
  let duration = document.getElementById("duration");
  let durationAmount = document.getElementById("durationAmount");
  let rotation = document.getElementById("rotation");
  let rotationAmount = document.getElementById("rotationAmount");
  let scale = document.getElementById("scale");
  let scaleAmount = document.getElementById("scaleAmount");
  let imgEditPrevDiv = document.getElementById("imgPrevEditDiv");
  let testSoundBtn = document.getElementById("testSoundBtn");
  let rt = document.getElementById("rotateTool");
  let st = document.getElementById("scaleTool");
  let vt = document.getElementById("volumeTool");
  let dt = document.getElementById("durationTool");


  let mediaMode = document.getElementById("mediaTypeText");
  mediaTypeButton.addEventListener("click", () => {

    console.log("Button Mode: ", mediaMode.innerText);
    if (mediaMode.innerText != "Sound") {
      dt.hidden = false;
      vt.hidden = false;
      rt.hidden = true;
      st.hidden = true;
      testSoundBtn.hidden = false;
      imgEditPrevDiv.hidden = true;
    }
    if (mediaMode.innerText != "Image") {
      dt.hidden = true;
      vt.hidden = true;
      rt.hidden = false;
      st.hidden = false;
      testSoundBtn.hidden = true;
      imgEditPrevDiv.hidden = false;
    }
  })

  scaleAmount.addEventListener("input", () => {
    scale.innerText = scaleAmount.value;
  })
  volumeAmount.addEventListener("input", () => {
    volume.innerText = volumeAmount.value;
  })
  rotationAmount.addEventListener("input", () => {
    rotation.innerText = rotationAmount.value;
    let image = document.getElementById("editImage");
  })
  durationAmount.addEventListener("input", () => {
    duration.innerText = durationAmount.value;
  })




</script>

<style>
  .videoDiv {
    border: 3px solid #3c39dd;
    background: #e6e9ff;
  }

  .chat-sidebar table td {
    border: 1px solid #b3adad;
    text-align: center;
    padding: 3px;
    background: #e6e9ff;
    color: #313030;
  }

  #video-grid {
    grid-template-columns: repeat(auto-fill, 300px);
    grid-auto-rows: 300px;
    overflow-x: scroll;
    margin-left: 0%;
    margin-right: 0%;
    margin-bottom: 10px;
    margin-top: 10px;
    border: 2px solid #667aff;
    padding: 5px;
    background-color: #e6e9ff;
    border-radius: 3px;
  }

  #video-table {
    max-width: 1100px;
    background: #fff;
    margin: 30px auto;
    overflow: hidden;
    padding: 10px;
  }

  table {
    border: 5px;
  }

  video {
    width: 0%;
    height: 0%;
    object-fit: cover;
  }

  #video {
    width: 25%;
    height: 25%;
    object-fit: cover;
  }

  canvas {
    object-fit: cover;
  }

  #settingBtn {
    padding: 3px;
  }
</style>

<script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
<script src="/socket.io/socket.io.js" defer></script>